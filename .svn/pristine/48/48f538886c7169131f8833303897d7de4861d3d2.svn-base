!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("mapPlugin requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function i(t){for(var e in t)this[e]=t[e]}return i.prototype={init:function(){this.zindex=1e3,this.createMap(),this.addStyle()},addStyle:function(){var t=document.createElement("style"),e=".anchorBL{display:none}.mapLabel{padding:5px 8px;background:#0093ff;border-radius:4px;font-size:14px;position:relative;display:inline-block;}.mapLabel:before{content:'';position:absolute;width:100%;height:4px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAECAYAAABCxiV9AAAABGdBTUEAALGPC/xhBQAAAFFJREFUCB1jZJj6fwLDP4Z8BnTAxDCRkeH/fyaGKQyrgXJBSPLrGHIYQpkYGBn/MYgzxDAwMhwHS4JoMJ/xHxNYIIzxOwMrgx+QvR1Mg/hAAAAwLBGaDQ9kbQAAAABJRU5ErkJggg==) center center no-repeat;left:0px;top:-4px;transform: rotateX(180deg);}.mapInfo{position:absolute;left:10px;top:"+(this.target?"10px;":"45px;")+"padding:10px;background:#fff;border:1px solid #d9d9d9;font-size:12px;line-height:22px;max-width:200px;}";e+=this.shade!==!1?"#mapPlungin:before{content:'';width:100%;height:"+document.documentElement.clientHeight+"px;position:fixed;background:#000;left:0;top:0;opacity:0.6}":"#mapPlungin{border:1px solid #dddddd;border-radius: 4px 4px 0 0;}",t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)},createMap:function(){var t=this;this.mapLoad=document.createElement("div"),this.info=document.createElement("div"),this.mapLoad.id="mapPlungin",this.info.className="mapInfo",this.info.style.display="none";var e={height:this.height+"px",width:this.width+"px",position:"fixed",paddingTop:"35px",opacity:"0",boxSizing:"border-box",backgroundColor:"#fff"};if("left"==this.align?e.left="0":"right"==this.align?(e.left="100%",e.marginLeft="-"+this.width+"px"):(e.left="50%",e.marginLeft="-"+this.width/2+"px"),"top"==this.vertical?e.top="0":"bottom"==this.vertical?(e.top="100%",e.marginTop="-"+this.height+"px"):(e.top="50%",e.marginTop="-"+this.height/2+"px"),"object"==typeof this.style)for(var i in this.style)e[i]=this.style[i];for(var i in e)this.mapLoad.style[i]=e[i];var a=document.createElement("div");a.id="mapContainer";var o={height:"100%",width:"100%"};for(var i in o)a.style[i]=o[i];var n=document.createElement("div"),p={position:"absolute",right:"5px",top:"3px",fontFamily:"SIMHEI",fontSize:"32px",color:"#b1b1b1",cursor:"pointer",zIndex:"100",background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA30lEQVQ4T6WTuxHCMBBE95JTSgfQAaYD0wGUQOSYiBqIiB25BOgAd4DpADogtRIx55E91sceBimUtO9WeydC4qJEPRzAuSx3zFwfD4dPDHypqoXWOj8Vxa0/HwAiBnAF0DDz1odY8R1ABmDfQwaAXGjbtiaitQ8Zi40xT6VU3hdwnhCDiFWtdVfZF8tZEOIYYox5dZeIVjFxFCCb1nIDYGnDejNzFgs32kbr4iGVBSBOlFKbnwB+YPYJQbBBG0fWncBkf6o7TgZzrZprcTBIU2l7kHCQxE7SKP/7qZJ/4xdV1LUR5I4v5AAAAABJRU5ErkJggg==)no-repeat center center",width:"30px",height:"30px"};n.onclick=function(){document.getElementById("mapPlungin").style.display="none",t.map.clearOverlays()};for(var i in p)n.style[i]=p[i];var r=document.createElement("div"),d={position:"absolute",left:"0px",top:"0px",cursor:"pointer",height:"35px",width:"100%",background:"#fff",borderRadius:"4px 4px 0 0"};for(var i in d)r.style[i]=d[i];this.dragable&&(r.onmousedown=function(e){r.style.cursor="move";var i={x:e.pageX,y:e.pageY},a={x:parseFloat(t.mapLoad.offsetLeft),y:parseFloat(t.mapLoad.offsetTop)};r.onmousemove=function(e){t.mapLoad.style.left=a.x+(e.pageX-i.x)-parseInt(t.mapLoad.style.marginLeft)+"px",t.mapLoad.style.top=a.y+(e.pageY-i.y)-parseInt(t.mapLoad.style.marginTop)+"px"}},r.onmouseup=function(){r.style.cursor="pointer",r.onmousemove=function(t){}}),document.getElementsByTagName("body")[0].appendChild(this.mapLoad),this.mapLoad.appendChild(a),this.mapLoad.appendChild(n),this.mapLoad.appendChild(r),this.target?(this.map=new BMap.Map(this.target),document.getElementById(this.target).appendChild(this.info)):(this.mapLoad.appendChild(this.info),this.map=new BMap.Map("mapContainer")),this.map.enableScrollWheelZoom(!0);var s=new BMap.Point(120.185053,30.25776);this.map.centerAndZoom(s,12),this.mapLoad.style.opacity="1",this.mapLoad.style.display="none";var l=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL});this.map.addControl(l),this.map.addEventListener("click",function(t){console.log(t.point.lng+", "+t.point.lat)})},show:function(t){var e=[],i=new BMap.Geocoder,a=this;this.info.innerHTML=function(){var e="";for(var i in t)"data"!=i&&(e+=i+":"+t[i]+"<br/>");return""==e&&(a.info.style.display="none"),e}(),this.info.style.display="",this.target||(this.mapLoad.style.display=""),this.map.clearOverlays();for(var o=0,n=t.data.length;o<n;o++){var p=new BMap.Point(t.data[o].lng,t.data[o].lat);e.push(p),function(e,o){i.getLocation(o,function(i){var n=i.addressComponents;t.data[e].address=n.province+n.city+n.district+"-"+n.street+n.streetNumber,a.addMarker(o,t.data[e])})}(o,p)}var r=new BMap.Polyline(e,{strokeColor:"#0093ff",strokeWeight:2,strokeOpacity:1});this.map.addOverlay(r),setTimeout(function(){a.zoom?a.map.centerAndZoom(e[0],a.zoom):(a.map.setViewport(e),a.map.setZoom(a.map.getZoom()-1))},100)},addMarker:function(t,e){var i=new BMap.Icon("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABGdBTUEAALGPC/xhBQAAAO5JREFUKBWdkj0KwkAQhd9GsQqktRYs7NQqjceQ3EBEwcZz2CiKeIPgMWxSRbsUgrVtIJUo67xdNxi0EKfYzMx+Mzs/UXiXjR7hgTEUOsatkaGGLSZq5zBllLVuCrgXsCu27y5f3wIaJwkcYqqunnFaOPwC89qXRKFJKIaCLWPh4KABRG1yQHwG8pvV5SzklbnCSqdi9OgmnEZAK6AFXHKgH1eCjl7ZoADM7GAGUHev0SZrezDWb4cnE8gcyppZhhPq9JUi7B9NM3ypD2Z0QL3MVlXuUkmCmRrYHrgUOji6T+HiErM4ubObdtAPv8YT615NaHUYqQEAAAAASUVORK5CYII=",new BMap.Size(12,12)),a=this,o=new BMap.Marker(t,{icon:i});this.map.addOverlay(o);var n={width:200,title:e.LBSName},p="<div style='line-height:24px;font-size:12px;word-break: break-all;'>时间："+e.time+"<br>地址："+e.address.replace("-","")+"<br>";this.device!==!1&&(p+="设备号："+e.deviceId+"<br>定位来源："+e.source+"<br>"),this.location!==!1&&(p+="经度："+e.lng+"<br>纬度："+e.lat+"<br>");for(var r in e)["LBSName","lng","lat","time","type","source","deviceId","address"].join(",").indexOf(r)==-1&&(p+=r+":"+e[r]+"<br>");p+="</div>",this.infoWindow=new BMap.InfoWindow(p,n),this.infoPonit=t;var d={position:t,offset:new BMap.Size((-41),10)},s=new BMap.Label(e.type?"<span class='mapLabel'>"+e.type+"</span>":"",d);s.setStyle({color:"white",fontSize:"12px",height:"30px",width:"80px",textAlign:"center",lineHeight:"20px",fontFamily:"微软雅黑",border:"none",borderRadius:"4px",background:"none"}),o.addEventListener("click",function(){this.map.openInfoWindow(a.infoWindow,t),s.setZIndex(a.zindex++),this.map.panBy(0,0)}),this.map.addOverlay(s)}},e||(t.MapPlungin=i),i});